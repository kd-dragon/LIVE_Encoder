<html xmlns:th="http://www.thymeleaf.org">
<div th:replace="inc/_header"></div>


<script type="text/javascript" th:inline="javascript">
/*<![CDATA[*/
var token = $("meta[name='_csrf']").attr("content");
var header = $("meta[name='_csrf_header']").attr("content");	
	
$(document).ready(function(){
	$(".lnb_2").addClass("open").addClass("active");
	
	$("#checkAll").click(function() {
		if($("#checkAll").prop("checked")) {
			$("input[name=checkBox]").prop("checked", true);
		} else {
			$("input[name=checkBox]").prop("checked", false);
		}
	});
	
	//검색 조건 유지
	if($("#searchStrDate").val() == ""){
		$("#searchDate").val('');
	} else{
		$("#searchDate").val($('#searchStrDate').val() + " ~ " + $('#searchEndDate').val());
	}
	
});

function goList(num) {
	$("#currentPage").val(num);
	setSearchDate();
	
	var f = document.vodForm;
	
	f.action = /*[[ @{/vod/vodList.do} ]]*/ '/vod/vodList.do';
	f.method = "post";
	f.submit();
}

//n개씩 보기
function changeBlockCount(num) {
	$("#blockCount").val(num);
	goList(1);
}


//등록일 검색
function setSearchDate() {
	if($("#searchDate").val() != ''){
		var dateArr = $('#searchDate').val().split(" ~ ");
		$('#searchStrDate').val(dateArr[0]);
		$('#searchEndDate').val(dateArr[1]);
	}
}

//검색조건 초기화
function goReset(){
	$("#searchDate").val('');
	$("#searchStrDate").val('');
	$("#searchEndDate").val('');
	$("#searchRegUserName").val('');
	$("#searchVodTitle").val('');
	$("#searchFileName").val('');
	
	goList(1);
}

//수정화면 이동
function goDetail(seq){
	var f = document.vodForm;
	
	f.vodSeq.value = seq; 
	f.action = /*[[ @{/vod/vodModifyForm.do} ]]*/ '/vod/vodModifyForm.do';
	f.method = "post";
	f.submit();
}


//작성화면 이동
function goWriteForm(){
	location.href = /*[[ @{/vod/vodWriteForm.do} ]]*/ '/vod/vodWriteForm.do';
}


//선택 삭제
function goDelete(){
	
	var chkCnt = 0;
	var vodSeqs = new Array();
	
	$("input[name=checkBox]").each(function(){
		if(this.checked){
			chkCnt++;
			vodSeqs.push($(this).val());
		}
	});
	
	if(chkCnt < 1){
		alert("선택된 영상이 없습니다.");
		return;
	}
	
	if(!confirm("영상을 삭제하시겠습니까?")){
		return;
	}
	
	$.ajax({
		beforeSend : function(xhr) {
			xhr.setRequestHeader(header, token);
		},
		url: /*[[ @{/vod/vodDelete.do} ]]*/ '/vod/vodDelete.do',
        type: 'POST',
		data: { vodSeqs : vodSeqs },
		success: function (type) {
			if (type == "SUCCESS") {
				alert("삭제되었습니다.");
			} else {
				alert("삭제에 실패했습니다.");
			}
		},
		error : function (e){
			alert("시스템 문제 발생으로 관리자에게 문의해주세요.");
		},
		complete : function() {
	       goList(1); 
	    }
		
	});
}

function vodExcelDown(){
	setSearchDate();
	
	var f = document.vodForm;
	
	f.action = /*[[ @{/vod/vodExcelDown.do} ]]*/ '/vod/vodExcelDown.do';
	f.method = "post";
	f.submit();
}

/*]]*/
</script>

<form id="vodForm" name="vodForm" method="post">
	<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
	<input type="hidden" id="blockCount" name="blockCount" th:value="${dto.blockCount}"/>
	<input type="hidden" id="currentPage" name="currentPage" th:value="${dto.currentPage}"/>
	
	<input type="hidden" id="searchStrDate" name="searchStrDate" th:value="${dto.searchStrDate}"/>
	<input type="hidden" id="searchEndDate" name="searchEndDate" th:value="${dto.searchEndDate}"/>
	
	<input type="hidden" id="vodSeq" name="vodSeq"/>

<!-- 컨텐츠 영역 -->
<div class="app-content content">
<div class="content-wrapper">
<!-- 컨텐츠:헤더-페이지명,네비게이터 -->
<div class="content-header row">
	<div class="content-header-left col-md-8 col-12 mb-2 breadcrumb-new">
		<h3 class="content-header-title mb-0 d-inline-block">VOD 관리</h3>
		<div class="row breadcrumbs-top d-inline-block">
			<div class="breadcrumb-wrapper col-12">
				<ol class="breadcrumb">
					<li class="breadcrumb-item">Home</li>
					<li class="breadcrumb-item active">VOD 관리</li>
				</ol>
			</div>
		</div>
	</div>
</div>
<!--// 컨텐츠:헤더-페이지명,네비게이터 -->
<!-- 컨텐츠:본문 영역 -->
<div class="content-body">
	<!-- 디스크립션 -->
	<div class="bs-callout-success mb-2">
		<div class="media align-items-stretch">
			<div class="media-left d-flex align-items-center bg-gray p-2">
				<i class="ft-check-square white font-medium-5"></i>
			</div>
			<div class="media-body p-1">
				<ul class="list-left list-disc mb-0">
					<li>동영상 인코딩을 관리하는 페이지 입니다.</li>
					<li>제목을 클릭하면 콘텐츠의 상세 정보를 확인할 수 있습니다.</li>
				</ul>
			</div>
		</div>
	</div>
	<!--// 디스크립션 -->
	<div class="row ">
		<div class="col-sm-12">
			<div class="card">
				<div class="card-header no-border-bottom">
					<h4 class="card-title">VOD 관리</h4>
					<a class="heading-elements-toggle"><i class="ft-more-horizontal font-medium-3"></i></a>
					<div class="heading-elements">
						<button type="button" class="btn btn-secondary btn-sm " onclick="goReset()"><i class="fa fa-repeat"></i> 검색조건 초기화</button>
						<button type="button" class="btn btn-primary btn-sm " onclick="goList(1)"><i class="fa fa-search"></i> 조회</button>
					</div>
				</div>
				<div class="card-content">
					<div class="card-body">
						<!-- 검색 -->
						<div class="search-area mb-1">
							<table cellpadding="0" cellspacing="0" class="w-100" summary="" >
								<colgroup>
									<col width="9%"/><col width="16%"/><col width="9%"/><col width="16%"/><col width="9%"/><col width="16%"/>
								</colgroup>
								<tbody>
									<tr>
										<th scope="col" class="">등록일</th>
										<td colspan="" class="">
											<!-- 일정 inputbox사용을 위해 필요한 참조 값 --><input id="picker_from" style="display:none;"><input id="picker_to" style="display:none;"><!-- 일정 inputbox사용을 위해 필요한 참조 값 -->
											<div class="input-group normal-child">
												<div class="input-group-prepend">
													<span class="input-group-text" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
														<span class="fa fa-calendar-o"></span>
													</span>
												</div>
												<input type='text' class="form-control linkedCalendars pull-right round-append" placeholder="" id="searchDate"/>
											</div>
										</td>
										<th scope="col" class="">등록자</th>
										<td colspan="" class="">
											<input type="text" class="form-control" title="" th:value="${dto.searchRegUserName}" name="searchRegUserName" id="searchRegUserName"/>
										</td> 
										<th scope="col">제목명</th>
										<td>
											<input type="text" class="form-control" title="" th:value="${dto.searchVodTitle}" name="searchVodTitle" id="searchVodTitle"/>
										</td>
<!-- 										<th scope="col">파일명</th> -->
<!-- 										<td> -->
<!-- 											<input type="text" class="form-control" title="" th:value="${dto.searchFileName}" name="searchFileName" id="searchFileName"/> -->
<!-- 										</td> -->
									</tr>

								</tbody>
							</table>
						</div>
						<!--// 검색 -->

						<!-- 버튼영역 -->
						<div class="position-relative mt-1">
							<div class="d-inline">
								<button type="button" class="btn btn-primary btn-sm" onclick="goWriteForm()"><i class="icon-film"></i> 동영상 등록</button>
								<button type="button" class="btn btn-sm btn-secondary" onclick="goDelete()">삭제</button>
							</div>
							<div class="position-absolute no-edge-top no-edge-right">
								<button type="button" class="btn btn-sm btn-info" onclick="vodExcelDown()">VOD 목록 다운로드</button>
							</div>
						</div>
						<!--// 버튼영역 -->

						<div class="list-summary no-line-bottom mt-Half">
							<div class="list-count">
								전체 : <b>[[ ${dto.totalCount} ]]</b>개 ([[ ${dto.currentPage} ]]/[[ ${dto.totalPage} ]]페이지)
							</div>
							<div class="page-count">
								<button type="button" class="btn btn-light btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">[[ ${dto.blockCount} ]]개씩보기</button>
								<div class="dropdown-menu">
									<a class="dropdown-item" href="javascript:changeBlockCount(10)">10개씩보기</a>
									<a class="dropdown-item" href="javascript:changeBlockCount(20)">20개씩보기</a>
									<a class="dropdown-item" href="javascript:changeBlockCount(40)">40개씩보기</a>
									<a class="dropdown-item" href="javascript:changeBlockCount(80)">80개씩보기</a>
									<a class="dropdown-item" href="javascript:changeBlockCount(100)">100개씩보기</a>
								</div>
								<!-- <div class="d-inline">
									<button type="button" class="btn btn-light btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">생성일순 정렬</button>
									<div class="dropdown-menu">
										<a class="dropdown-item" href="#">생성일순 정렬</a>
										<a class="dropdown-item" href="#">등록일순 정렬</a>
									</div>
								</div> -->
							</div>
						</div>

						<div class="table-responsive thumb-list">
							<table cellpadding="0" cellspacing="0" class="table table-design-cust text-center" summary="" >
								<colgroup>
									<col width="3%"/>
									<col width="5%"/>
									<col width="15%"/>
									<col width="12%"/>
									<col width="30%"/>
									<col width="5%"/>
									<col width="5%"/>
									<col width="5%"/>
									<col width="8%"/>
									<col width="13%"/>
								</colgroup>
								<thead>
									<tr>
										<th scope="">
											<div class="form-check abc-checkbox">
												<input class="form-check-input" type="checkbox" id="checkAll" value="option1" aria-label="Single checkbox One">
												<label class="form-check-label" for="checkAll"></label>
											</div>
										</th>
										<th scope="">No</th>
										<th scope="">카테고리</th>
										<th scope="">미리보기</th>
										<th scope="">제목명</th>
<!-- 										<th scope="">파일명</th> -->
										<th scope="">원본용량</th>
										<th scope="">인코딩용량</th>
										<th scope="">변환상태</th>
										<th scope="">등록자</th>
										<th scope="">등록일시</th>
									</tr>
								</thead>
								<tbody>
									<!-- list empty -->
									<tr th:if="${#lists.isEmpty(dto.vodList)}">
										<td colspan="12" class="text-center py-4"><b>저장된 VOD 목록이 없습니다.</b></td>
									</tr>
									<!-- list not empty -->
									<tr th:unless="${#lists.isEmpty(dto.vodList)}" th:each="item : ${dto.vodList}">
										<td>
											<div class="form-check abc-checkbox">
												<input class="form-check-input" type="checkbox" th:id="'checkbox' + ${itemStat.index}" name="checkBox" th:value="${item.vodSeq}" aria-label="Single checkbox One">
												<label class="form-check-label" th:for="'checkbox' + ${itemStat.index}"></label>
											</div>
										</td>
										<td th:text="${dto.totalCount - (dto.blockCount * (dto.currentPage - 1) + itemStat.index)}"></td>
<!-- 										<td class="text-left" th:utext="${item.fullCategory}"></td> -->
										<td class="text-left" th:utext="${item.categoryName}"></td>
										<td>						
											<div class="img-box">
												<img th:src="@{/app-assets/images/moviethumb/playbtn.png}" alt="" class="ico-type">
												<th:block th:if="${ #strings.isEmpty(item.thumbFileName) || #strings.equals(item.thumbFileName, '')}">
												<img th:src="@{/app-assets/images/sample/no-image.jpg}" alt="" class="thumb">
												</th:block>
												<th:block th:unless="${ #strings.isEmpty(item.thumbFileName) || #strings.equals(item.thumbFileName, '')}">
												<img th:src="@{${item.thumbFilePath}+${item.thumbFileName}}" alt="" class="thumb">
												</th:block>
											</div>
										</td>
										<td class="text-left" style="max-width: 100px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;"><a href="#" th:onclick="goDetail([[ ${item.vodSeq} ]])" th:utext="${item.vodTitle}"></a></td>
<!-- 										<th:block th:if="${#strings.isEmpty(item.originalFileName) || #strings.equals(item.originalFileName, '')}"> -->
<!-- 										<td class="text-left"><a th:onclick="goDetail([[ ${item.vodSeq} ]])" th:utext="${item.encodingFileName}"></a></td> -->
<!-- 										</th:block> -->
<!-- 										<th:block th:unless="${#strings.isEmpty(item.originalFileName) || #strings.equals(item.originalFileName, '')}"> -->
<!-- 										<td class="text-left"><a th:onclick="goDetail([[ ${item.vodSeq} ]])" th:utext="${item.originalFileName}"></a></td> -->
<!-- 										</th:block> -->
										<td th:text="${item.originalFileSize}"></td>
										<td th:text="${item.encodingFileSize}"></td>
										
										<td th:if="${#strings.equals(item.vodStatus, '1')}">성공</td>
										<td th:if="${#strings.equals(item.vodStatus, '0')}">대기</td>
										<td th:if="${#strings.equals(item.vodStatus, '3')}">인코딩중</td>
										<td th:if="${#strings.equals(item.vodStatus, '4')}">실패</td>
										
										<td th:text="${item.regUserName}"></td>
										<td th:text="${item.regDate}"></td>
									</tr>
								</tbody>
							</table>	
						</div>
						<!-- 페이징 -->
						<div th:utext="${dto.pagingHtml}">
						<!-- //페이징 -->
					</div>
				</div>
			</div>
		</div>
	</div>

</div>
</div>
</div>
</form>
<div th:replace="inc/_footer"></div>
