<html xmlns:th="http://www.thymeleaf.org">
<!-- Modal : 관리자 정보 수정 -->
<div class="modal fade text-left" id="modifyUser" tabindex="-1"
	role="dialog" aria-labelledby="modifyUserLabel" aria-hidden="true">
	<form>
	<div class="modal-dialog modal-md" role="document">
		<div class="modal-content">
			<div class="modal-header bg-info">
				<h4 class="modal-title white" id="modifyUserLabel">관리자 정보 수정</h4>
				<button type="button" class="close" data-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true" onclick="cancelModifyAdmin();">×</span>
				</button>
			</div>
			<div class="modal-body">
				<ul class="list-left list-disc">
					<li>항목 우측의 <span class="danger">*</span>표시는 는 필수 입력사항 입니다.
					</li>
				</ul>

				<h5>관리자 정보</h5>
				<div class="view-form view-form-vertical">
					<table cellpadding="0" cellspacing="0" class=" w-100" summary="">
						<colgroup>
							<col width="20%" />
							<col width="80%" />
						</colgroup>
						<tbody>
							<!-- <tr>
								<th>관리자 권한</th>
								<td><select name="" title="" class="form-control">
										<option value="">선택하세요.</option>
										<option value="">관리자</option>
										<option value="" selected="selected">일반사용자</option>
								</select></td>
							</tr> -->
							<tr>
								<th>이름</th>
								<td>
									<input type="text" id="userName" name="userName" disabled/>
								</td>
							</tr>
							<tr>
								<th>아이디</th>
								<td>
									<input type="text" id="userId" name="userId" disabled/>
								</td>
							</tr>
							<tr>
								<th>비밀번호</th>
								<td><input type="password" class="form-control" title=""
									value="" name="modifyPw" id="modifyPw" /> <span class="small danger">※ 비밀번호는
										최소8~15이내, 숫자, 특수문자, 영문자를 포함하여 생성이 가능합니다.</span> <!-- 
									<p class="small danger mt-2">
										※ 개발시 참조 디스크립션<br/>
										[시스템관리 > 시스템설정 > 로그인비밀번호관리]에서 사용자가 선택한 생성규칙을 노출해주세요.<br/>
										이 디스크립션은 개발이 완료되면 삭제부탁드립니다^^ 감사합니다.
									</p>
									--></td>
							</tr>
							<tr>
								<th>비밀번호 확인</th>
								<td><input type="password" class="form-control" title=""
									value="" name="modifyPwChk" id="modifyPwChk"/> <!--
									<span class="small info">※ 비밀번호가 일치합니다.</span>
									<span class="small danger">※ 비밀번호를 다시 한번 확인해주세요.</span> 
									--></td>
							</tr>
							<tr>
								<th>메뉴 권한<span class="danger ml-Half">*</span></th>
								<td>
									<select class="form-control" id="modAuthSeq" name="modAuthSeq">
										<option value="" selected="selected">권한을 선택해주세요</option>
										<th:block th:each="item : ${dto.authList}">
										<option th:value="${item.authSeq}">[[ ${item.authName} ]]</option>
										</th:block>
									</select>
								</td>
							</tr>
						</tbody>
					</table>
				</div>

			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-outline-success"
					id="modify-modal" onclick="modifyAdmin()">저장</button>
				<button type="button" class="btn btn-outline-secondary"
					data-dismiss="modal" onclick="cancelModifyAdmin();">취소</button>
			</div>
		</div>
	</div>
	</form>
</div>
<!--// Modal : 관리자 정보 수정 -->
<script type="text/javascript" th:inline="javascript">
/*<![CDATA[*/
	var token = $("meta[name='_csrf']").attr("content");
	var header = $("meta[name='_csrf_header']").attr("content");
	
	//비밀번호 암호화
	function modifyValidateEncryptedForm() {
		var modifyPw = $.trim($("#modifyPw").val());
		
		try {
			var rsaPublicKeyModules = $("#rsaPublicKeyModules").val();
			var rsaPublicKeyExponent = $("#rsaPublicKeyExponent").val();
			
			modifySubmitEncrytedForm(modifyPw, rsaPublicKeyModules, rsaPublicKeyExponent);
		} catch(err) {
			alert(err);
			return false;
		}
		return true;
	}
	
	function modifySubmitEncrytedForm(modifyPw, rsaPublicKeyModules, rsaPublicKeyExponent) {
		var rsa = new RSAKey();
		
		rsa.setPublic(rsaPublicKeyModules, rsaPublicKeyExponent);
		if(modifyPw == "") {
			$("#modifyPw").val("");
		} else {
			$("#modifyPw").val(rsa.encrypt(modifyPw));
		}
		
		modifyPassword();
	}
	
	function modifyAdmin() {
		var pwChk = /^(?=.*[a-zA-z])(?=.*[0-9])(?=.*[$`~!@$!%*#^?&\\(\\)\-_=+]).{8,15}$/;
		var maxLen = 15;
		
		if($.trim($("#modifyPw").val()) != null && $.trim($("#modifyPw").val()) != "") {
			if(!pwChk.test($.trim($("#modifyPw").val()))) {
				alert("비밀번호 입력 규칙을 확인해주세요.");
				$("#modifyPw").focus();
				return;
			} else if($.trim($("#modifyPwChk").val()) == "" || $.trim($("#modifyPwChk").val()) == null) {
				alert("비밀번호 확인 칸에 비밀번호를 입력해주세요.");
				$("#modifyPwChk").focus();
				return;
			} else if($.trim($("#modifyPw").val()) != $.trim($("#modifyPwChk").val())) {
				alert("비밀번호가 일치하지 않습니다.");
				return;
			}
		}
			
		if($("#modAuthSeq").val() == null || $("#modAuthSeq").val() == "") {
			alert("메뉴 권한을 선택해주세요.");
			return;
		}
		
	if(!modifyValidateEncryptedForm()) return;
	
	}
	
	function modifyPassword() {
		$.ajax({
			beforeSend : function(xhr) {
				xhr.setRequestHeader(header, token);
			},
			url : /*[[ @{/system/modifyAdmin.do} ]]*/ '/system/modifyAdmin.do',
			data : {
				"luPwd" : $("#modifyPw").val(),
				"luId" : $("#userId").val(),
				"authSeq" : $("#modAuthSeq").val()
			},
			dataType : 'text',
			type : "POST",
			success : function(type) {
				if(type == "SUCCESS") {
					alert("정보 수정이 완료되었습니다.");
				} else {
					alert("정보 수정을 실패했습니다.");
				}
			},
			error : function(e) {
				alert("시스템 에러가 발생하였습니다. 관리자에게 문의하세요.");
			},
			complete : function() {
				goList(1);
			}
		});
	}
	
	//취소 버튼 누른 후 모든 데이터 초기화
	function cancelModifyAdmin() {
		$("#modifyPw").val("");
		$("#modifyPwChk").val("");
	}
	
	//비밀번호 15자리 넘어가면 자르기
	$("#modifyPw").on('keyup', function() {
		if($(this).val().length > 15) {
			$(this).val($(this).val().substring(0, 15));
			alert("비밀번호는 15자를 초과할 수 없습니다.");
		}
	});
/*]]*/
</script>