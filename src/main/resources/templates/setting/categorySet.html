<html xmlns:th="http://www.thymeleaf.org">
<div th:replace="inc/_header"></div>

<style>
#categoryGroup ul {list-style:none;}
#categoryGroup li {list-style:none;} 
#categoryGroup ol {list-style:none;} 
#categoryGroup dl {list-style:none;} 
#categoryGroup dt {list-style:none;} 
#categoryGroup dd {list-style:none;} 

</style>
<script type="text/javascript" th:inline="javascript">

/*<![CDATA[*/
	var token = $("meta[name='_csrf']").attr("content");
	var header = $("meta[name='_csrf_header']").attr("content");	
	
	$(document).ready(function() {
		$(".lnb_3").addClass("open");
		$(".lnb_3_3").addClass("active");
	});


	//카테고리 현재 상태 모두 저장
	function saveCategory(){
		//카테고리명 폼 체크
		if ($("#cateName").val().trim() == "") {
			alert("카테고리명을 입력해주세요.");
			$("#cateName").focus();
			return;
		}
		
		var categoryInfo = {
				"cateName" : $("#cateName").val(),
				"upCateSeq" : $("#upCateSeq").val(),
				"regUseYn" : $("#regUseYn").val(),
				"cateComent" : $("#cateComent").val(),
				"cateLevel" : $("#cateLevel").val()
		};
		
		$.ajax({
			beforeSend : function(xhr) {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
				xhr.setRequestHeader(header, token);
			},
			url: /*[[ @{/setting/insertCategory.do} ]]*/ '',
			data : categoryInfo,
			dataType: 'text',
			type: "POST",
			success: function(rtn) {
				if(rtn == "SUCCESS") {
					alert("카테고리 추가 등록되었습니다.");
					location.reload();
				} else if(rtn == "EXIST") {
					alert("중복된 카테고리명이 존재합니다.");
				}
			},
			error: function(e) {
				alert("카테고리 추가 등록에 실패하였습니다. ");
				
			}
		});	
		
	}
	
	// 카테고리 수정
	function modCategory(){
		
		//카테고리명 폼 체크
		if ($("#modCateName").val().trim() == "") {
			alert("카테고리명을 입력해주세요.");
			$("#modCateName").focus();
			return;
		}
			
		var categoryModInfo = {
				"targetCateSeq" : $("#targetCateSeq").val(),
				"modUpCateSeq" : $("#modUpCateSeq").val(),
				"modCateName" : $("#modCateName").val(),
				"modUseYn" : $("#modUseYn").val(),
				"modComent" : $("#modComent").val(),
		};

		$.ajax({
			beforeSend : function(xhr) {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
			    xhr.setRequestHeader(header, token);
			},
			url: /*[[ @{/setting/updateCategory.do} ]]*/ '',
			data : categoryModInfo,
			dataType: 'text',
			type: "POST",
			success: function(rtn) {
				if(rtn == "SUCCESS") {
					alert("카테고리 정보가 수정되었습니다.");
					location.reload();
				} else if(rtn == "EXIST") {
					alert("중복된 카테고리명이 존재합니다.");
				}
			},
			error: function(e) {
				alert("카테고리 정보 수정에 실패하였습니다. ");
			}
		});	
	}
	
	function delCateChk() {

		//카테고리 선택 체크
		if( $("#targetCateSeq").val().trim() == ""  || $("#targetCateSeq").val().trim() == null ){
			alert("삭제할 카테고리를 선택해주세요.");
			return;
		}
		
		//카테고리 삭제 확인 창
		if(confirm("선택한 카테고리를 삭제하시겠습니까?") == true){
			deleteCategory();
		} else {
			return;
		}
	}
	
	//카테고리 삭제
	function deleteCategory(){
		
		var categoryDelInfo = {
				"targetCateSeq" : $("#targetCateSeq").val()
		}
		
		$.ajax({
			beforeSend : function(xhr) {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
			    xhr.setRequestHeader(header, token);
			},
			url: /*[[ @{/setting/deleteCategory.do} ]]*/ '',
			data : categoryDelInfo,
			dataType: 'text',
			type: "POST",
			success: function(rtn) {
				alert("카테고리 정보가 삭제되었습니다.");
				location.reload();
			},
			error: function(e) {
				alert("카테고리 정보 삭제에 실패하였습니다. ");
				console.log(e);
				
			}
		});	
		
	}

	
	// 카테고리 추가 form show
	function addCategoryFrom() {
		
		$("#targetCateSeq").val(null);
		
		$(".cateWrite").removeClass("d-none");
		$(".cateModify").addClass("d-none");
	}
	
	// 카테고리 수정 form show
	function modCategoryFrom(obj) {
		
		$("#targetCateSeq").val($(obj).attr("id"));
// 		$("#modUpCateSeq").val($(obj).attr("id"))
		$("#modFullCateName").val($(obj).attr("fullCategoryName"));
		$("#modCateName").val($(obj).attr("cateName"));
		$("#modcUseYn").val($(obj).attr("useYn"));
		$("#modComent").val($(obj).attr("coment"));
		
		$(".cateWrite").addClass("d-none");
		$(".cateModify").removeClass("d-none");
		
		if($(obj).attr("cateLevel") == '1'){
			
			$("#btnModCategory").attr("disabled", true);
			$("#modUseYn").attr("disabled", true);

		}
	}
	
	// 입력/수정 폼 감추기
	function hideForm() {
		$(".cateWrite").addClass("d-none");
		$(".cateModify").addClass("d-none");
	}
/*]]*/
</script>
<div class="app-content content">
<div class="content-wrapper">
<!-- 컨텐츠:헤더-페이지명,네비게이터 -->
<div class="content-header row">
	<div class="content-header-left col-md-8 col-12 mb-2 breadcrumb-new">
		<h3 class="content-header-title mb-0 d-inline-block">카테고리 관리</h3>
		<div class="row breadcrumbs-top d-inline-block">
			<div class="breadcrumb-wrapper col-12">
				<ol class="breadcrumb">
					<li class="breadcrumb-item">Home</li>
					<li class="breadcrumb-item">인코딩 설정</li>
					<li class="breadcrumb-item active">카테고리 관리</li>
				</ol>
			</div>
		</div>
	</div>
</div>
<!--// 컨텐츠:헤더-페이지명,네비게이터 -->
<!-- 컨텐츠:본문 영역 -->
<div class="content-body">
	<!-- 디스크립션 -->
	<div class="bs-callout-success mb-2">
		<div class="media align-items-stretch">
			<div class="media-left d-flex align-items-center bg-gray p-2">
				<i class="ft-check-square white font-medium-5"></i>
			</div>
			<div class="media-body p-1">
				<ul class="list-left list-disc mb-0">
					<li>카테고리 삭제 시, 선택한 카테고리에 해당하는 콘텐츠가 존재할 경우 삭제할 수 없습니다.</li>
				</ul>
			</div>
		</div>
	</div>
	<!--// 디스크립션 -->
	<div class="row">
		<!-- 카테고리 분류  -->
		<div class="col-sm-6">
			<div class="card">
				<div class="card-header">
					<h4 class="card-title">카테고리</h4>
					<div class="heading-elements">
						<button type="button" class="btn btn-primary btn-sm" onclick="addCategoryFrom();"><i class="ft-folder"></i> 등록</button>
						<button type="button" class="btn btn-secondary btn-sm" onclick="delCateChk();">삭제</button>
					</div>
				</div>
				<div class="card-content">
					<div class="card-body">
						<ul class="noChk cate-group" id="categoryGroup">
							<th:block th:utext="${detailCategoryHtml}"></th:block>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<!--// 카테고리 분류 -->

		<!-- 카테고리 추가 Form -->
		<div class="col-sm-6  cateWrite d-none">
			<div class="card">
				<div class="card-header">
					<h4 class="card-title">카테고리 추가</h4>
					<div class="heading-elements">
					</div>
				</div>
				<form id="addCategoryForm" name="addCategoryForm" method="post">
					<input type="hidden" id="lbCategorySeq" name="lbCategorySeq" >
					<input type="hidden" id="callType" value="setCategory">
					<input type="hidden" id="cateLevel" name="cateLevel">
					<input type="hidden" id="upCateSeq" name="upCateSeq" th:value="0"/>
					
					<div class="card-content">
						<div class="card-body">
							<div class="regist-form">
								<table cellpadding="0" cellspacing="0" class="w-100" summary="" >
									<colgroup>
										<col width="20%"/><col width=""/>
									</colgroup>
									<tbody>
										<!-- <tr id="upCategoryTr">
											<th scope="">상위 카테고리</th>
											<td>
												<div class="input-group">
													<input type="text" class="form-control" id="fullCategoryName" name="fullCategoryName" readonly/>
													<div class="input-group-append">
														<button type="button" class="btn btn-outline-info"
															data-toggle="modal" data-target="#callCategory"
															id="btnCategory">카테고리선택</button>
													</div>
													<button type="button" class="btn btn-outline-secondary ml-Half">초기화</button>
												</div>
											</td>
										</tr> -->
										<tr>
											<th scope="">카테고리명</th>
											<td>
												<input type="text" class="form-control" id="cateName" name="cateName" maxlength="20"/>
												<!-- <input type="hidden" id="cateSeq" name="cateSeq"/>
												<input type="hidden" id="cateDepth" name="cateDepth"/> -->
											</td>
										</tr>
										<tr>
											<th scope="">사용여부</th>
											<td>
											<select id="regUseYn" name="" class="form-control">
												<option value="Y" selected>활성</option>
												<option value="N">비활성</option>
											</select>
										</td>
										</tr>
										<tr>
											<th scope="">설명</th>
											<td><textarea class="form-control height-100" id="cateComent" name="cateComent" ></textarea></td>
										</tr>
									</tbody>
								</table>
							</div>
	
							<div class="text-right mt-1">
								<button type="button" class="btn btn-success px-2" onclick="saveCategory();">등록</button>
								<button type="button" class="btn btn-secondary px-2" onclick="hideForm();">취소</button>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
		<!--// 카테고리 추가 Form  -->

		<!-- 카테고리 수정 Form -->
		<div class="col-sm-6  cateModify d-none">
			<div class="card">
				<div class="card-header">
					<h4 class="card-title">카테고리 수정</h4>
					<div class="heading-elements">
					</div>
				</div>
				<form id="modCategoryForm" name="modCategoryForm" method="post">
				<input type="hidden" id="targetCateSeq" name="targetCateSeq">
				<input type="hidden" id="modUpCateSeq" name="modUpCateSeq" value="0">
				<input type="hidden" id="callType" value="setCategory">
					 
					<div class="card-content">
						<div class="card-body">
							<div class="regist-form">
								<table cellpadding="0" cellspacing="0" class="w-100" summary="" >
									<colgroup>
										<col width="20%"/><col width=""/>
									</colgroup>
									<tbody>
										<!-- <tr>
											<th scope="">상위 카테고리</th>
											<td>
												<div class="input-group">
													<input type="text" class="form-control" value="" id="modFullCateName" name="modFullCateName" readonly/>
													<div class="input-group-append">
														<button type="button" class="btn btn-outline-info"
															data-toggle="modal" data-target="#callCategory"
															id="btnModCategory">카테고리선택</button>
													</div>
													<button type="button" id="initBtn" class="btn btn-outline-secondary ml-Half" onclick="reset('modify')">초기화</button>
												</div>
											</td> 
										</tr> -->
										<tr>
											<th scope="">카테고리 명</th>
											<td><input type="text" class="form-control" value="" id="modCateName" name="modCateName"/></td>
										</tr>
										<tr>
											<th scope="">사용여부</th>
											<td>
												<select id="modUseYn" name="modUseYn" class="form-control">
													<option value="Y">사용</option>
													<option value="N">미사용</option>
												</select>
												<span class="small success">※ 미사용 선택 시, 하위 카테고리까지 모두 적용됩니다.</span>
											</td>
										</tr>
									</tbody>
										<tr>
											<th scope="">설명</th>
											<td><textarea class="form-control height-100" id="modcoment" name="modcoment" cols="" rows="" ></textarea></td>
										</tr>
								</table>
							</div>
	
							<div class="text-right mt-1">
								<button type="button" class="btn btn-success px-2" onclick="modCategory();">저장</button>
								<button type="button" class="btn btn-secondary px-2" onclick="hideForm();">취소</button>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
		<!--// 카테고리 수정 Form -->


	</div>
</div>
<!--// 컨텐츠 본문 영역 -->
</div>
</div>
<!--// 컨텐츠 영역 -->
<div th:replace="inc/_footer"></div>
<!-- 팝업인크루드 -->
<div th:replace="popup/callCategory"></div>
<!--// 팝업인크루드 -->
