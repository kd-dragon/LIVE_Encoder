<html xmlns:th="http://www.thymeleaf.org">
<div th:replace="inc/_header"></div>

<script type="text/javascript" th:inline="javascript">
/*<![CDATA[*/
var token = $("meta[name='_csrf']").attr("content");
var header = $("meta[name='_csrf_header']").attr("content");

$(document).ready(function(){
	/* 이미지파일 및 파일 삭제 */
	$('.del-file').click(function(){
		$(this).closest('.upload-file-box').find('.upload-asis').addClass('d-none');
		$(this).closest('.upload-file-box').find('.add-file').removeClass('d-none');
	});
	
	
	$(".lnb_5").addClass("open"); 
	$(".lnb_5_1").addClass("active");
});

function uploadImgFile() {
	var formData = new FormData($("#theForm")[0]);
	
	$.ajax({
		beforeSend: function(xhr) {
			xhr.setRequestHeader(header, token);
		},
		url : /*[[ @{/userHome/updateBannerImgFile.do}]]*/ '/userHome/updateBannerImgFile.do',
		data : formData,
		dataType : 'json',
		type : 'POST',
		enctype : "multipart/form-data",
		processData : false,
		contentType : false,
		success : function(data) {
			if(data.result == true) {
				save(data.fileList);
			} else {
				alert("업로드 처리중에 오류가 발생하였습니다. 다시 시도해주세요.");
				return;
			}
		},
		error : function(e) {
			alert("시스템 에러가 발생하였습니다. 관리자에게 문의하세요.");
			return;
		}
	});
}

function save(files) {
	var banner1 = {};
	var banner2 = {};
	var banner3 = {};
	var banner4 = {};
	var banner5 = {};
	
	$.each(files, function(idx, item) {
		if(item.fileIdx == 1) {
			banner1.bannerImgFilePath = item.filePath,
			banner1.bannerImgFileName = item.fileName,
			banner1.bannerImgFileNameServer = item.fileNameServer
		} else if(item.fileIdx == 2) {
			banner2.bannerImgFilePath = item.filePath,
			banner2.bannerImgFileName = item.fileName,
			banner2.bannerImgFileNameServer = item.fileNameServer
		} else if(item.fileIdx == 3) {
			banner3.bannerImgFilePath = item.filePath,
			banner3.bannerImgFileName = item.fileName,
			banner3.bannerImgFileNameServer = item.fileNameServer
		} else if(item.fileIdx == 4) {
			banner4.bannerImgFilePath = item.filePath,
			banner4.bannerImgFileName = item.fileName,
			banner4.bannerImgFileNameServer = item.fileNameServer
		} else if(item.fileIdx = 5) {
			banner5.bannerImgFilePath = item.filePath,
			banner5.bannerImgFileName = item.fileName,
			banner5.bannerImgFileNameServer = item.fileNameServer
		}
	});
	
	for(var i=1; i<=$("tbody:visible").length; i++) {
		var delYn = "N";
		if($("#bannerTbody" + i).find(".upload-asis").length == 0 || $("#bannerTbody" + i).find(".upload-asis").hasClass("d-none")) {
			delYn = "Y";
		}
		
		var bannerSeq = $("#bannerSeq" + i).val();
		var bannerShortcutUrl = $("#bannerShortcutUrl" + i).val();
		var bannerOrder = $("#bannerOrder" + i).val();
		
		eval("banner"+ i + ".bannerSeq=\"" + bannerSeq + "\"");
		eval("banner"+ i + ".bannerShortcutUrl=\""+ bannerShortcutUrl + "\"");
		eval("banner"+ i + ".bannerOrder=\"" + bannerOrder + "\"");
		eval("banner"+ i + ".delYn=\"" + delYn + "\"");
 		
	}
	
	var jsonData = {
			banner1 : banner1,
			banner2 : banner2,
			banner3 : banner3,
			banner4 : banner4,
			banner5 : banner5
	 	};
	
	$.ajax({
		beforeSend: function(xhr) {
			xhr.setRequestHeader(header, token);
		},
		url : /*[[ @{/userHome/modifyMainBanner.do}]]*/ '/userHome/modifyMainBanner.do',
		data : JSON.stringify(jsonData),
		dataType : 'text',
		type : "POST",
		traditional : true,
		contentType : 'application/json',
		success : function(type) {
			if(type == "SUCCESS") {
				alert("정상적으로 저장되었습니다.");
				reload();
			} else {
				alert("저장 처리 중, 오류가 발생하였습니다. 다시 시도해주세요.");
			}
		},
		error : function(e) {
			alert("시스템 에러가 발생하였습니다. 관리자에게 문의하세요.");
		}
	});
}

function reload() {
	window.location.reload();
}

/*]]*/
</script>
<!-- 컨텐츠 영역 -->
<div class="app-content content">
<div class="content-wrapper">
<!-- 컨텐츠:헤더-페이지명,네비게이터 -->
<div class="content-header row">
	<div class="content-header-left col-md-8 col-12 mb-2 breadcrumb-new">
		<h3 class="content-header-title mb-0 d-inline-block">메인 배너 관리</h3>
		<div class="row breadcrumbs-top d-inline-block">
			<div class="breadcrumb-wrapper col-12">
				<ol class="breadcrumb">
					<li class="breadcrumb-item">회원가입</li>
					<li class="breadcrumb-item">사용자홈페이지관리</li>
					<li class="breadcrumb-item active">메인배너관리</li>
				</ol>
			</div>
		</div>
	</div>
</div>
<!--// 컨텐츠:헤더-페이지명,네비게이터 -->
<!-- 컨텐츠:본문 영역 -->
<div class="content-body">
	<!-- 디스크립션 -->
	<div class="bs-callout-success mb-2">
		<div class="media align-items-stretch">
			<div class="media-left d-flex align-items-center bg-gray p-2">
				<i class="ft-check-square white font-medium-5"></i>
			</div>
			<div class="media-body p-1">
				<ul class="list-left list-disc mb-0">
					<li>배너이미지는 774x260사이즈를 권장합니다.</li>
<!-- 					<li>배너이미지와 함께 사용할 문장을 메인카피와 서브카피로 나누어 입력하시기 바랍니다.</li> -->
				</ul>
			</div>
		</div>
	</div>
	<!--// 디스크립션 -->
	<div class="row">
		<!-- 배너관리 -->
		<div class="col-xl-12">
			<div class="card">
				<!-- <div class="card-header">
					<h4 class="card-title">배너관리 </h4>
					<div class="heading-elements"></div>
				</div> -->
				<div class="card-content">
					<div class="card-body">
					<form id="theForm" name="theForm" method="post" enctype="multipart/form-data">
					<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
						<!--  테이블:: 배너01 -->
						<div class="position-relative">
							<h6 ><b>배너01</b></h6>
							<div class="position-absolute no-edge-bottom no-edge-right"></div>
						</div>

						<div class="w-100 regist-form regist-form-vertical view-poll">
							<table cellpadding="0" cellspacing="0" class="table text-left mb-0" summary="">
								<colgroup>
									<col width="10%"/><col width="90%"/>
								</colgroup>
								<tbody id="bannerTbody1">
									<tr>
										<th>배너이미지</th>
										<td class="upload-file-box text-height" th:if="${banner1 != null}">
										<input type="hidden" name="bannerOrder" id="bannerOrder1" value="1"/>
											<div class="upload-asis">
												<div class="img-box">
													<span class="file-ctrl">
													<a href="##" class="badge badge-pill badge-secondary del-file"><i class="ft-x white"></i></a></span>
													<div class="banner-img">
														<img th:src="@{${banner1.bannerImgFileWebPath} + ${banner1.bannerImgFileNameServer}}" class="w-100" alt=""/>
													</div>
												</div>
											</div>
											<div class="d-none add-file">
												<input type="file" class="w-100" title="" value="" name="bannerImgFile" id="bannerImgFile1" placeholder="" accept="image/*"/>
											</div>
											<input type="hidden" name="bannerSeq" id="bannerSeq1" th:value="${banner1.bannerSeq}"/>
										</td>
										
										<td class="upload-file-box text-height" th:unless="${banner1 != null}">
										<input type="hidden" name="bannerOrder" id="bannerOrder1" value="1"/>
											<div class="add-file">
												<input type="file" class="w-100" title="" value="" name="bannerImgFile" id="bannerImgFile1" placeholder=""  accept="image/*"/>
											</div>
												<input type="hidden" name="bannerSeq" id="bannerSeq1"/>
										</td>
									</tr>
									<tr>
										<th>바로가기URL</th>
										<td th:if="${banner1 != null}">
											<input type="text" class="form-control" title="" th:value="${banner1.bannerShortcutUrl}" id="bannerShortcutUrl1" name="bannerShortcutUrl"/>
										</td>
										<td th:unless="${banner1 != null}">
											<input type="text" class="form-control" title="" value="" id="bannerShortcutUrl1" name="bannerShortcutUrl"/>
										</td>
									</tr>
								</tbody>
							</table>
						</div> <!--//테이블:: 배너02 -->
						<div class="position-relative mt-2">
							<h6 ><b>배너02</b></h6>
							<div class="position-absolute no-edge-bottom no-edge-right"></div>
						</div>

						<div class="w-100 regist-form regist-form-vertical view-poll">
							<table cellpadding="0" cellspacing="0" class="table text-left mb-0" summary="">
								<colgroup>
									<col width="10%"/><col width="90%"/>
								</colgroup>
								<tbody id="bannerTbody2">
									<tr>
										<th>배너이미지</th>
										<td class="upload-file-box text-height" th:if="${banner2 != null}">
										<input type="hidden" name="bannerOrder" id="bannerOrder2" value="2"/>
											<div class="upload-asis">
												<div class="img-box">
													<span class="file-ctrl">
													<a href="##" class="badge badge-pill badge-secondary del-file"><i class="ft-x white"></i></a></span>
													<div class="banner-img">
														<img th:src="@{${banner2.bannerImgFileWebPath} + ${banner2.bannerImgFileNameServer}}" class="w-100" alt=""/>
													</div>
												</div>
											</div>
											<div class="d-none add-file">
												<input type="file" class="w-100" title="" value="" name="bannerImgFile" id="bannerImgFile2" placeholder="" accept="image/*"/>
											</div>
											<input type="hidden" name="bannerSeq" id="bannerSeq2" th:value="${banner2.bannerSeq}"/>
										</td>
										
										<td class="upload-file-box text-height" th:unless="${banner2 != null}">
										<input type="hidden" name="bannerOrder" id="bannerOrder2" value="2"/>
											<div class="add-file">
												<input type="file" class="w-100" title="" value="" name="bannerImgFile" id="bannerImgFile2" placeholder=""  accept="image/*"/>
											</div>
											<input type="hidden" name="bannerSeq" id="bannerSeq2"/>
										</td>
									</tr>
									<tr>
										<th>바로가기URL</th>
										<td th:if="${banner2 != null}">
											<input type="text" class="form-control" title="" th:value="${banner2.bannerShortcutUrl}" id="bannerShortcutUrl2" name="bannerShortcutUrl"/>
										</td>
										<td th:unless="${banner2 != null}">
											<input type="text" class="form-control" title="" value="" id="bannerShortcutUrl2" name="bannerShortcutUrl"/>
										</td>
									</tr>
								</tbody>
							</table>
						</div> <!--//테이블:: 배너02 -->
			
						<div class="position-relative mt-2">
							<h6 ><b>배너03</b></h6>
							<div class="position-absolute no-edge-bottom no-edge-right"></div>
						</div>

						<div class="w-100 regist-form regist-form-vertical view-poll">
							<table cellpadding="0" cellspacing="0" class="table text-left mb-0" summary="">
								<colgroup>
									<col width="10%"/><col width="90%"/>
								</colgroup>
								<tbody id="bannerTbody3">
									<tr>
										<th>배너이미지</th>
										<td class="upload-file-box text-height" th:if="${banner3 != null}">
										<input type="hidden" name="bannerOrder" id="bannerOrder3" value="3"/>
											<div class="upload-asis">
												<div class="img-box">
													<span class="file-ctrl">
													<a href="##" class="badge badge-pill badge-secondary del-file"><i class="ft-x white"></i></a></span>
													<div class="banner-img">
														<img th:src="@{${banner3.bannerImgFileWebPath} + ${banner3.bannerImgFileNameServer}}" class="w-100" alt=""/>
													</div>
												</div>
											</div>
											<div class="d-none add-file">
												<input type="file" class="w-100" title="" value="" name="bannerImgFile" id="bannerImgFile3" placeholder="" accept="image/*"/>
											</div>
											<input type="hidden" name="bannerSeq" id="bannerSeq3" th:value="${banner3.bannerSeq}"/>
										</td>
										
										<td class="upload-file-box text-height" th:unless="${banner3 != null}">
										<input type="hidden" name="bannerOrder" id="bannerOrder3" value="3"/>
											<div class="add-file">
												<input type="file" class="w-100" title="" value="" name="bannerImgFile" id="bannerImgFile3" placeholder=""  accept="image/*"/>
											</div>
											<input type="hidden" name="bannerSeq" id="bannerSeq3"/>
										</td>
									</tr>
									<tr>
										<th>바로가기URL</th>
										<td th:if="${banner3 != null}">
											<input type="text" class="form-control" title="" th:value="${banner3.bannerShortcutUrl}" id="bannerShortcutUrl3" name="bannerShortcutUrl"/>
										</td>
										<td th:unless="${banner3 != null}">
											<input type="text" class="form-control" title="" value="" id="bannerShortcutUrl3" name="bannerShortcutUrl"/>
										</td>
									</tr>
								</tbody>
							</table>
						</div> <!--//테이블:: 배너03 -->
						
						<div class="position-relative mt-2">
							<h6 ><b>배너04</b></h6>
							<div class="position-absolute no-edge-bottom no-edge-right"></div>
						</div>

						<div class="w-100 regist-form regist-form-vertical view-poll">
							<table cellpadding="0" cellspacing="0" class="table text-left mb-0" summary="">
								<colgroup>
									<col width="10%"/><col width="90%"/>
								</colgroup>
								<tbody id="bannerTbody4">
									<tr>
										<th>배너이미지</th>
										<td class="upload-file-box text-height" th:if="${banner4 != null}">
										<input type="hidden" name="bannerOrder" id="bannerOrder4" value="4"/>
											<div class="upload-asis">
												<div class="img-box">
													<span class="file-ctrl">
													<a href="##" class="badge badge-pill badge-secondary del-file"><i class="ft-x white"></i></a></span>
													<div class="banner-img">
														<img th:src="@{${banner4.bannerImgFileWebPath} + ${banner4.bannerImgFileNameServer}}" class="w-100" alt=""/>
													</div>
												</div>
											</div>
											<div class="d-none add-file">
												<input type="file" class="w-100" title="" value="" name="bannerImgFile" id="bannerImgFile4" placeholder="" accept="image/*"/>
											</div>
											<input type="hidden" name="bannerSeq" id="bannerSeq4" th:value="${banner4.bannerSeq}"/>
										</td>
										
										<td class="upload-file-box text-height" th:unless="${banner4 != null}">
										<input type="hidden" name="bannerOrder" id="bannerOrder4" value="4"/>
											<div class="add-file">
												<input type="file" class="w-100" title="" value="" name="bannerImgFile" id="bannerImgFile4" placeholder=""  accept="image/*"/>
											</div>
											<input type="hidden" name="bannerSeq" id="bannerSeq4"/>
										</td>
									</tr>
									<tr>
										<th>바로가기URL</th>
										<td th:if="${banner4 != null}">
											<input type="text" class="form-control" title="" th:value="${banner4.bannerShortcutUrl}" id="bannerShortcutUrl4" name="bannerShortcutUrl"/>
										</td>
										<td th:unless="${banner4 != null}">
											<input type="text" class="form-control" title="" value="" id="bannerShortcutUrl4" name="bannerShortcutUrl"/>
										</td>
									</tr>
								</tbody>
							</table>
						</div> <!--//테이블:: 배너04 -->
						
						<div class="position-relative mt-2">
							<h6 ><b>배너05</b></h6>
							<div class="position-absolute no-edge-bottom no-edge-right"></div>
						</div>

						<div class="w-100 regist-form regist-form-vertical view-poll">
							<table cellpadding="0" cellspacing="0" class="table text-left mb-0" summary="">
								<colgroup>
									<col width="10%"/><col width="90%"/>
								</colgroup>
								<tbody id="bannerTbody5">
									<tr>
										<th>배너이미지</th>
										<td class="upload-file-box text-height" th:if="${banner5 != null}">
										<input type="hidden" name="bannerOrder" id="bannerOrder5" value="5"/>
											<div class="upload-asis">
												<div class="img-box">
													<span class="file-ctrl">
													<a href="##" class="badge badge-pill badge-secondary del-file"><i class="ft-x white"></i></a></span>
													<div class="banner-img">
														<img th:src="@{${banner5.bannerImgFileWebPath} + ${banner5.bannerImgFileNameServer}}" class="w-100" alt=""/>
													</div>
												</div>
											</div>
											<div class="d-none add-file">
												<input type="file" class="w-100" title="" value="" name="bannerImgFile" id="bannerImgFile5" placeholder="" accept="image/*"/>
											</div>
											<input type="hidden" name="bannerSeq" id="bannerSeq5" th:value="${banner5.bannerSeq}"/>
										</td>
										
										<td class="upload-file-box text-height" th:unless="${banner5 != null}">
										<input type="hidden" name="bannerOrder" id="bannerOrder5" value="5"/>
											<div class="add-file">
												<input type="file" class="w-100" title="" value="" name="bannerImgFile" id="bannerImgFile5" placeholder=""  accept="image/*"/>
											</div>
											<input type="hidden" name="bannerSeq" id="bannerSeq5"/>
										</td>
									</tr>
									<tr>
										<th>바로가기URL</th>
										<td th:if="${banner5 != null}">
											<input type="text" class="form-control" title="" th:value="${banner5.bannerShortcutUrl}" id="bannerShortcutUrl5" name="bannerShortcutUrl"/>
										</td>
										<td th:unless="${banner5 != null}">
											<input type="text" class="form-control" title="" value="" id="bannerShortcutUrl5" name="bannerShortcutUrl"/>
										</td>
									</tr>
								</tbody>
							</table>
						</div> <!--//테이블:: 배너05 -->
					</form>
					</div>
				</div>
				<div class="card-footer">
					<div class="mr-auto float-left"></div>
					<div class="mr-auto float-right">
						<button type="button" class="btn btn-success px-2" th:onclick="uploadImgFile();">저장</button>
					</div>
				</div>
			</div>
		</div>
		<!--// 배너관리 -->

	</div>
</div>
<!--// 컨텐츠 본문 영역 -->
</div>
</div>
<!--// 컨텐츠 영역 -->
<div th:replace="inc/_footer"></div>