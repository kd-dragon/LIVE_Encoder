<!DOCTYPE html>
<html class="loading width-mobile" lang="en" data-textdirection="ltr" xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>TG 1st MOVIE Live 동영상 라이브 솔루션</title>
<link rel="apple-touch-icon" th:href="@{/app-assets/images/ico/apple-icon-120.png}">
<link rel="shortcut icon" type="image/x-icon" th:href="@{/app-assets/images/ico/favicon.ico}">

<!-- rsa -->
<script type="text/javascript" th:src="@{/assets/js/rsa/rsa.js}"></script>
<script type="text/javascript" th:src="@{/assets/js/rsa/jsbn.js}"></script>
<script type="text/javascript" th:src="@{/assets/js/rsa/prng4.js}"></script>
<script type="text/javascript" th:src="@{/assets/js/rsa/rng.js}"></script>
<script type="text/javascript" th:src="@{/assets/js/jquery-3.5.1.min.js}"></script>
<!-- rsa -->

<!-- 새 페이지 생성시 반드시 필요한 CSS -->
<link rel="stylesheet" type="text/css" th:href="@{/app-assets/css/vendors.css}">
<link rel="stylesheet" type="text/css" th:href="@{/app-assets/css/app.css}">
<link rel="stylesheet" type="text/css" th:href="@{/app-assets/css/core/menu/menu-types/vertical-menu.css}">
<link rel="stylesheet" type="text/css" th:href="@{/assets/css/style.css}">
<!-- //새 페이지 생성시 반드시 필요한 CSS -->
<!-- icheck style checkbox 스타일 CSS -->
<link rel="stylesheet" type="text/css" th:href="@{/app-assets/vendors/css/forms/icheck/icheck.css}">
<link rel="stylesheet" type="text/css" th:href="@{/app-assets/vendors/css/forms/icheck/custom.css}">
<!-- //icheck style checkbox 스타일 CSS -->
<!-- 로그인 및 회원가입 CSS -->
<link rel="stylesheet" type="text/css" th:href="@{/app-assets/css/pages/login-register.css}">
<!-- //로그인 및 회원가입 CSS -->
</head>

<script type="text/javascript" th:inline="javascript">
/*<![CDATA[*/
$(function(){
	checkCookie();
});

//Enter 이벤트 제거
document.addEventListener('keydown', function(event) {
  if (event.keyCode === 13) {
    event.preventDefault();
  };
}, true);

function loginChk(){
	
	var curTime = new Date().getTime();
	var nowTime = new Date().getTime();
	var diff = (nowTime - curTime)/1000;
	
	if(diff>1800){//tomcat 기본 세션타임보다 클 경우 세션 만료, 만료이후 다시 키를 받기 위해 새로고침한다.
		alert('페이지가 만료되었습니다. \n 다시 시도해주세요');
		location.href = /*[[@{loginForm.do}]]*/ "/loginForm.do";
				return;
	}
	
	if ($('#userId').val() == "" || $('#userId').val() == null) { //입력하지 않은 경우
		alert('사용자 아이디를 입력하세요.'); //알림창
		$('#userId').focus(); //입력 란 포커싱
		return;
	}

	if ($('#userPw').val() == "" || $('#userPw').val() == null) {
		alert("비밀번호를 입력하세요.");
		$('#userPw').focus(); 
		return;
	}
	
	if(!validateEncryptedForm()) return;

}
	
function validateEncryptedForm() {
	
	var userName = document.getElementById("userId").value.trim();//사용자 입력 아이디 
	var userPw = document.getElementById("userPw").value.trim();//사용자 입력  비번

	try {
		var rsaPublicKeyModules = $("#rsaPublicKeyModules").val();

		var rsaPublicKeyExponent = $("#rsaPublicKeyExponent").val();

		submitEncrytedForm(userName, userPw, rsaPublicKeyModules,
				rsaPublicKeyExponent);

	} catch (err) {
		alert(err);
		return false;
	}
	return true;

}

function submitEncrytedForm(userName, userPw, rsaPublicKeyModules,
		rsaPublicKeyExponent) {//암호화 함수

	var rsa = new RSAKey();

	rsa.setPublic(rsaPublicKeyModules, rsaPublicKeyExponent);

	//사용자 아이디,비밀번호 RSA 암호화
	document.getElementById("encId").value = rsa.encrypt(userName);
	document.getElementById("encPw").value = rsa.encrypt(userPw);
	
	if ($('input:checkbox[id="remember-me"]').is(":checked")) {//쿠키에 아이디 저장
		setCookieb("LoginID", document.getElementById("userId").value,
				86400 * 30);
	} else {
		delCookie();
	}	
	
	document.getElementById("userId").value = "";//암호화 되지 않은 아이디 값 비우기
	document.getElementById("userPw").value = "";//암호화 되지 않은 비밀번호 값 비우기

	
	
	document.loginForm.action = "/loginChk.do";
	document.loginForm.method = "post";
	document.loginForm.submit();

}

function checkCookie(){
	var userID= getCookie("LoginID");
	
	if(userID.length>0){
		document.getElementById("userId").value = userID;
		$('input:checkbox[id="remember-me"]').attr("checked",true);
		document.getElementById("userPwd").focus();
	}else{
		document.getElementById("userId").focus();
	}
	
	
}
function delCookie(){

	if(!$('input:checkbox[id="remember-me"]').is(":checked")){//쿠키에 아이디 저장

		setCookieb("LoginID", "",-1);
		document.getElementById("userId").value="";
		document.getElementById("userId").focus();
	}
}

function setCookieb(name, value, expiredays) {
	var todayDate = new Date();
	todayDate.setTime(todayDate.getTime() + expiredays); 
	document.cookie = name + "=" + escape(value) + "; path=/; expires="+ todayDate.toGMTString() + ";"
}
function getCookie(name){ 
	var nameOfCookie = name + "=";
	var x = 0; 
	
	while ( x <= document.cookie.length ) { 
		var y = (x+nameOfCookie.length);
		if ( document.cookie.substring( x, y ) == nameOfCookie ) {
			if ( (endOfCookie=document.cookie.indexOf( ";", y )) == -1 ) endOfCookie = document.cookie.length; 
		
			return unescape( document.cookie.substring( y, endOfCookie ) );
		} 
		x = document.cookie.indexOf( " ", x ) + 1;
		if ( x == 0 ) break; 
	} 
	return "";
}
/*]]*/
</script>

<body class="vertical-layout menu-expanded blank-page">
<!-- 컨텐츠 영역 -->
<div class="app-content content">
<div class="content-wrapper">
<div class="content-header row"></div>
<div class="content-body">
<!-- 컨텐츠:본문 영역 -->
<section class="flexbox-container">
	<div class="col-12 d-flex align-items-center justify-content-center">
		<div class="col-md-4 col-10 box-shadow-2 p-0">
			<div class="card border-grey border-lighten-3 m-0">
				<div class="card-header border-0">
					<div class="card-title text-center">
						<div class="p-1">
							<a class="navbar-brand" th:href="@{/loginForm.do}"><img class="brand-logo mb-0" alt="robust admin logo" th:src="@{/app-assets/images/logo/logo-dark-sm.png}">
							<h3 class="brand-text">
							<strong>TG 1st MOVIE Live</strong>
							<br>
							<small>동영상 라이브 솔루션</small></h3></a>
						</div>
					</div>
					<h6 class="card-subtitle line-on-side text-muted text-center font-small-4 pt-2">
						<span>로그인 후 편리하게 이용하세요.</span>
					</h6>
				</div>
				<div class="card-content">
					<div class="card-body pb-4">
						<form id="loginForm" name="loginForm" class="form-simple">
						<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
						<input type="hidden" name="rsaPublicKeyModules" id ="rsaPublicKeyModules" th:value="${session['rsaPublicKeyModules']}"/>
						<input type="hidden" name="rsaPublicKeyExponent" id="rsaPublicKeyExponent" th:value="${session['rsaPublicKeyExponent']}"/>
						<input type="hidden" name="encId" id="encId"/>
						<input type="hidden" name="encPw" id="encPw"/>
						
							<fieldset class="form-group position-relative has-icon-left mb-0">
								<input type="text" class="form-control form-control-lg input-lg" name="userId" id="userId" placeholder="아이디" onkeydown="if(event.keyCode == 13) loginChk();">
								<div class="form-control-position"><i class="ft-user"><!--아이디 아이콘--></i></div>
							</fieldset>
								<fieldset class="form-group position-relative has-icon-left">
								<input type="password" class="form-control form-control-lg input-lg" name="userPw" id="userPw" placeholder="비밀번호" onkeydown="if(event.keyCode == 13) loginChk();">
								<div class="form-control-position"><i class="fa fa-key"><!--비밀번호 아이콘--></i></div>
							</fieldset>
							<div class="form-group row">
								<div class="col-md-6 col-12 text-center text-md-left">
									<fieldset>
										<input type="checkbox" id="remember-me" class="chk-remember"> <label for="remember-me">아이디 기억</label>
									</fieldset>
								</div>
							</div>
							<button type="button" class="btn btn-info btn-lg btn-block" th:onclick="loginChk()"><i class="ft-unlock"></i> 로그인</button>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>
<!--// 컨텐츠:본문 영역 -->
</div>
</div>
</div>

<!--푸터 영역-->
<div th:replace="inc/_footer"></div>
<!-- <footer class="footer footer-static footer-transparent">
	<p class="clearfix blue-grey lighten-2 text-sm-center mb-0 px-2">
		<span class="float-md-left ">Copyright &copy; <a class="text-bold-800 grey darken-2" href="http://www.tigensoft.co.kr/"	target="_blank">Tigensoft</a>, All rights reserved. </span>
		<span class="float-md-center">TG 1st LSM Lite는 익스플로러 11이상의 환경에 최적화된 프로그램입니다.</span>
		<span class="float-md-right">시스템 문의: 02-2051-9857 <i class="ft-phone-call"></i></span>
	</p>
</footer> -->
<!--//푸터 영역-->

<!-- 새 페이지 생성시 반드시 필요한 JS -->
<script th:src="@{/app-assets/vendors/js/vendors.min.js}" type="text/javascript"></script>
<script th:src="@{/app-assets/js/core/app-menu.js}" type="text/javascript"></script>
<script th:src="@{/app-assets/js/core/app.js}" type="text/javascript"></script>
<script th:src="@{/assets/js/link.js}" type="text/javascript"></script>
<!--// 새 페이지 생성시 반드시 필요한 JS -->


<script th:src="@{/app-assets/vendors/js/forms/icheck/icheck.min.js}" type="text/javascript"></script>
<script th:src="@{/app-assets/vendors/js/forms/validation/jqBootstrapValidation.js}" type="text/javascript"></script>
<script th:src="@{/app-assets/js/scripts/forms/form-login-register.js}" type="text/javascript"></script>