
<html xmlns:th="http://www.thymeleaf.org">
<div th:replace="inc/_header"></div>

<script type="text/javascript" th:inline="javascript">
	/*<![CDATA[*/
	$(document).ready(
			function() {
				$(".lnb_1").addClass("open");
				$(".lnb_1_1").addClass("open").addClass("active");

				//조회 조건 유지
				$("#searchStatus").val(/*[[ ${dto.searchStatus} ]]*/);
				$("#searchOpen").val(/*[[ ${dto.searchOpen} ]]*/);

				changeSearchTextType(/*[[ ${dto.searchTextType} ]]*/);

				if ($("#searchStDate").val() == "") {
					$("#fullDate").val('');
				} else {
					$("#fullDate").val(
							$('#searchStDate').val() + " ~ "
									+ $('#searchEnDate').val());
				}

				if ($("#orderByType").val() == 'start') {
					$("#orderByField").text("방송시작일시순 정렬");
				} else {
					$("#orderByField").text("등록일순 정렬");
				}

				$("#checkAll").click(function() {
					if ($("#checkAll").prop("checked")) {
						$("input[name=checkBox]").prop("checked", true);
					} else {
						$("input[name=checkBox]").prop("checked", false);
					}
				});

			});

	//탭 이동
	function selectLiveList(status) {
		searchReset();
		$("#orderByType").val("");
		$("#blockCount").val("10");
		$("#searchStatus").val("");

		var frm = document.liveForm;
		var url = "";

		if (status == 'finish') {
			url = /*[[@{/live/liveFinishList.do}]]*/'/live/liveFinishList.do';
		} else if (status == 'wait') {
			url = /*[[@{/live/liveWaitList.do}]]*/'/live/liveWaitList.do';
		} else {
			url = /*[[@{/live/liveOnAirList.do}]]*/'/live/liveOnAirList.do';
		}

		frm.action = url;
		frm.submit();
	}

	//검색어 옵션 선택
	function changeSearchTextType(type) {

		if (type == "ALL") {
			$("#searchTextType").val("");
			$("#searchField").text("전체");

		} else if (type == "TITLE") {
			$("#searchTextType").val("TITLE");
			$("#searchField").text("제목");

		} else if (type == "REGUSER") {
			$("#searchTextType").val("REGUSER");
			$("#searchField").text("등록자");

		}
	}

	//검색
	function goList(num) {
		$("#searchText").val($("#searchText").val().trim());
		$("#currentPage").val(num);

		if ($('#fullDate').val() != '') {
			var dateArr = $('#fullDate').val().split(" ~ ");

			$('#searchStDate').val(dateArr[0]);
			$('#searchEnDate').val(dateArr[1]);
		}

		var f = document.liveForm;

		f.action = /*[[ @{/live/liveFinishList.do} ]]*/'/live/liveFinishList.do';
		f.method = "post";
		f.submit();
	}

	//검색조건 초기화
	function searchReset() {
		$("#searchOpen").val("");
		changeSearchTextType("ALL");
		$("#fullDate").val("");
		$('#searchStDate').val("");
		$('#searchEnDate').val("");
		$("#searchText").val("");
		$("#searchStatus").val("");
		$("#blockCount").val(10);
		$("#orderByType").val('reg');
		goList(1);
	}

	//blockCount 변경
	function changeBlockCount(num) {
		$("#blockCount").val(num);
		goList(1);
	}

	//orderBy 변경
	function changeOrderby(type) {
		$("#orderByType").val(type);
		goList(1);
	}

	//라이브 방송 등록 페이지로 이동
	function registBroadcast() {
		window.location.href = /*[[ @{/live/registBroadcastForm.do} ]]*/'/live/registBroadcastForm.do';
	}

	//선택 복제
	function copyBroadcast() {

		var chkCnt = 0;
		var lbSeq = "";

		$("input[name=checkBox]").each(function() {
			if (this.checked) {
				chkCnt++;
				lbSeq = $(this).val();
			}
		});

		if (chkCnt < 1) {
			alert("복제할 방송을 선택해주세요.");
			return;
		}

		if (chkCnt != 1) {
			alert("1개의 방송만 선택해주세요.");
			return;
		}

		var f = document.liveForm;
		f.lbSeq.value = lbSeq;
		var url = /*[[ @{/live/copyBroadcastForm.do} ]]*/'/live/copyBroadcastForm.do';
		f.action = url;
		f.submit();
	}

	//라이브 목록 다운로드
	function downloadExcel() {
		var f = document.liveForm;
		var url = /*[[ @{/live/finishExcelDown.do}]]*/'/live/finishExcelDown.do';
		f.action = url;
		f.submit();
	}

	//방속 삭제
	function goDelete() {
		chkCnt = 0;
		var lbSeqs = new Array();

		$("input[name=checkBox]").each(function() {
			if (this.checked) {
				chkCnt++;
				lbSeqs.push($(this).val());
			}
		});

		if (chkCnt < 1) {
			alert("선택된 방송이 없습니다.");
			return;
		}

		if (!confirm("방송을 삭제하시겠습니까?")) {
			return;
		}

		var token = $("meta[name='_csrf']").attr("content");
		var header = $("meta[name='_csrf_header']").attr("content");

		$
				.ajax({
					beforeSend : function(xhr) { //데이터를 전송하기 전에 헤더에 csrf값을 설정한다
						xhr.setRequestHeader(header, token);
					},
					url : /*[[ @{/live/removeBroadcast.do} ]]*/'/live/removeBroadcast.do',
					type : 'POST',
					traditional : true,
					data : {
						lbSeqs : lbSeqs,
						searchStatus : $("#searchStatus").val()
					},
					success : function(type) {
						if (type == "SUCCESS") {
							alert("방송이 삭제되었습니다.");
						} else {
							alert("방송 삭제에 실패했습니다.");
						}
					},
					error : function(e) {
						alert("시스템 문제 발생으로 관리자에게 문의해주세요.");
					},
					complete : function() {
						goList(1);
					}

				});
	}

	function goDetail(seq, status) {
		var f = document.liveForm;

		f.lbSeq.value = seq;
		if (status == "2" || status == "5") {
			f.action = /*[[ @{/live/viewBroadcastFinish.do} ]]*/'/live/viewBroadcastFinish.do';
		} else {
			f.action = /*[[ @{/live/viewBroadcastError.do} ]]*/'/live/viewBroadcastError.do';
		}
		f.submit();
	}
	/*]]*/
</script>


<form id="liveForm" name="liveForm" method="post">
	<input type="hidden" th:name="${_csrf.parameterName}"
		th:value="${_csrf.token}" /> <input type="hidden" id="blockCount"
		name="blockCount" th:value="${dto.blockCount}" /> <input
		type="hidden" id="currentPage" name="currentPage"
		th:value="${dto.currentPage}" /> <input type="hidden" id="lbSeq"
		name="lbSeq" />

	<!-- 검색에 사용 -->
	<input type="hidden" name="searchStDate" id="searchStDate"
		th:value="${dto.searchStDate}"> <input type="hidden"
		name="searchEnDate" id="searchEnDate" th:value="${dto.searchEnDate}">
	<input type="hidden" name="searchTextType" id="searchTextType"
		th:value="${dto.searchTextType}"> <input type="hidden"
		name="orderByType" id="orderByType" th:value="${dto.orderByType}">



	<!-- 컨텐츠 영역 -->
	<div class="app-content content">
		<div class="content-wrapper">
			<!-- 컨텐츠:헤더-페이지명,네비게이터 -->
			<div class="content-header row">
				<div class="content-header-left col-md-8 col-12 mb-2 breadcrumb-new">
					<h3 class="content-header-title mb-0 d-inline-block">라이브방송관리</h3>
					<div class="row breadcrumbs-top d-inline-block">
						<div class="breadcrumb-wrapper col-12">
							<ol class="breadcrumb">
								<li class="breadcrumb-item">홈</li>
								<li class="breadcrumb-item">라이브방송관리</li>
								<li class="breadcrumb-item active">라이브방송관리</li>
							</ol>
						</div>
					</div>
				</div>
			</div>
			<!--// 컨텐츠:헤더-페이지명,네비게이터 -->
			<!-- 컨텐츠:본문 영역 -->
			<div class="content-body">
				<div class="row ">
					<div class="col-sm-12">
						<div class="card">
							<div class="card-header">
								<div class="information">
									<ul class="nav nav-tabs nav-top-border no-hover-bg">
										<li class="nav-item"><a class="nav-link"
											href="javascript:selectLiveList('onair');">실시간 라이브 방송 중</a></li>
										<li class="nav-item"><a class="nav-link"
											href="javascript:selectLiveList('wait');">방송 대기</a></li>
										<li class="nav-item"><a class="nav-link active"
											href="javascript:selectLiveList('finish');">방송 완료</a></li>
									</ul>
								</div>
							</div>
							<div class="card-content">
								<div class="card-body">
									<!-- 탭 영역 -->
									<div class="tab-content">
										<!-- 방송 완료 탭 내용 -->
										<div class="tab-pane active">

											<!-- 검색 -->
											<div class="position-relative">
												<div class="d-inline">
													<h4 class="card-title">방송 완료 목록</h4>
												</div>
												<div class="position-absolute no-edge-top no-edge-right">
													<div class="d-inline">
														<button type="button" class="btn btn-secondary btn-sm"
															onclick="searchReset()">
															<i class="fa fa-repeat"></i> 검색조건 초기화
														</button>
														<button type="button" class="btn btn-primary btn-sm"
															onclick="goList(1)">
															<i class="fa fa-search"></i> 조회
														</button>
													</div>
												</div>
											</div>
											<div class="search-area">
												<table cellpadding="0" cellspacing="0" class="w-100"
													summary="">
													<colgroup>
														<col width="8%" />
														<col width="12%" />
														<col width="8%" />
														<col width="12" />
														<col width="8%" />
														<col width="23%" />
														<col width="8%" />
														<col width="21%" />
													</colgroup>

													<tbody>
														<tr>
															<th scope="col" class="">상태</th>
															<td><select id="searchStatus" name="searchStatus"
																title="" class="form-control">
																	<option value="" selected="selected">전체</option>
																	<option value="2">종료</option>
																	<option value="5">VOD 저장대기</option>
																	<!-- 																<option value="9">오류</option> -->
															</select></td>
															<th scope="col" class="">공개구분</th>
															<td><select id="searchOpen" name="searchOpen"
																title="" class="form-control">
																	<option value="" selected="selected">전체</option>
																	<option value="Y">공개</option>
																	<option value="N">비공개</option>
															</select></td>
															<th scope="col">
																<div class="position-relative">
																	<button type="button" class="btn dropdown-toggle"
																		data-toggle="dropdown" aria-haspopup="true"
																		aria-expanded="true" id="searchField"
																		name="searchField">검색어</button>
																	<div class="dropdown-menu">
																		<a class="dropdown-item"
																			href="javascript:changeSearchTextType('ALL')">전체</a>
																		<a class="dropdown-item"
																			href="javascript:changeSearchTextType('TITLE')">제목</a>
																		<a class="dropdown-item"
																			href="javascript:changeSearchTextType('REGUSER')">등록자</a>
																	</div>
																</div>
															</th>
															<td><input type="text" class="form-control"
																th:value="${dto.searchText}" name="searchText"
																id="searchText" /></td>
															<th scope="col">방송일</th>
															<td colspan="" class="">
																<!-- 일정 inputbox사용을 위해 필요한 참조 값 --> <input
																id="picker_from" style="display: none;"><input
																id="picker_to" style="display: none;"> <!-- 일정 inputbox사용을 위해 필요한 참조 값 -->
																<div class="input-group normal-child">
																	<div class="input-group-prepend">
																		<span class="input-group-text range"
																			data-toggle="dropdown" aria-haspopup="true"
																			aria-expanded="true"> <span
																			class="fa fa-calendar-o"></span>
																		</span>
																	</div>
																	<input type='text'
																		class="form-control linkedCalendars pull-right round-append"
																		id="fullDate" name="fullDate" />
																</div>
															</td>
														</tr>
													</tbody>
												</table>
											</div>
											<!--// 검색 -->

											<!-- 버튼영역 -->
											<div class="position-relative mt-1">
												<div class="d-inline">
													<button type="button" class="btn btn-primary btn-sm"
														onclick="registBroadcast()">
														<i class="ft-tv"></i> 라이브방송 등록
													</button>
													<!-- <button type="button" class="btn btn-primary btn-sm" onclick="copyBroadcast()"><i class="ft-copy"></i> 선택 복제</button> -->
													<button type="button" class="btn btn-secondary btn-sm"
														onclick="goDelete()">삭제</button>
												</div>
												<div class="position-absolute no-edge-top no-edge-right">
													<button type="button" class="btn btn-sm btn-info"
														onclick="downloadExcel()">라이브 목록 다운로드</button>
												</div>
											</div>
											<!--// 버튼영역 -->
											<div class="list-summary no-line-bottom mt-Half">
												<div class="list-count">
													전체 : <b>[[ ${dto.totalCount} ]]</b>건 ([[ ${dto.currentPage}
													]]/[[ ${dto.totalPage} ]]페이지)
												</div>
												<div class="page-count">
													<button type="button"
														class="btn btn-light btn-sm dropdown-toggle"
														data-toggle="dropdown" aria-haspopup="true"
														aria-expanded="true">[[ ${dto.blockCount} ]]개씩보기</button>
													<div class="dropdown-menu">
														<a class="dropdown-item"
															href="javascript:changeBlockCount(10)">10개씩보기</a> <a
															class="dropdown-item"
															href="javascript:changeBlockCount(20)">20개씩보기</a> <a
															class="dropdown-item"
															href="javascript:changeBlockCount(40)">40개씩보기</a> <a
															class="dropdown-item"
															href="javascript:changeBlockCount(80)">80개씩보기</a> <a
															class="dropdown-item"
															href="javascript:changeBlockCount(100)">100개씩보기</a>
													</div>
													<div class="d-inline">
														<button type="button"
															class="btn btn-light btn-sm dropdown-toggle"
															data-toggle="dropdown" aria-haspopup="true"
															aria-expanded="true" id="orderByField">등록일순 정렬</button>
														<div class="dropdown-menu">
															<a class="dropdown-item"
																href="javascript:changeOrderby('reg')">등록일순 정렬</a> <a
																class="dropdown-item"
																href="javascript:changeOrderby('start')">방송시작일시순 정렬</a>
														</div>
													</div>
												</div>
											</div>
											<!-- 테이블 영역 -->
											<div class="table-responsive">
												<table cellpadding="0" cellspacing="0"
													class="table table-design-cust text-center" summary="">
													<colgroup>
														<col width="2%" />
														<col width="2%" />
														<col width="10%" />
														<col width="32%" />
														<col width="5%" />
														<col width="5%" />
														<col width="10%" />
														<col width="10%" />
														<col width="5%" />
														<col width="10%" />
														<col width="10%" />
													</colgroup>
													<thead>
														<tr>
															<th>
																<div class="form-check abc-checkbox">
																	<input class="form-check-input" type="checkbox"
																		id="checkAll" aria-label="Single checkbox 00">
																	<label class="form-check-label" for="checkAll"></label>
																</div>
															</th>
															<th>순번</th>
															<th>채널</th>
															<th>방송제목</th>
															<th>상태</th>
															<th>공개구분</th>
															<th>방송 시작 일시</th>
															<th>방송 종료 일시</th>
															<th>방송 시간</th>
															<th>등록자</th>
															<th>등록일</th>
														</tr>
													</thead>
													<tbody>
														<!-- list empty -->
														<tr th:if="${#lists.isEmpty(dto.liveList)}">
															<td colspan="10" class="text-center py-4"><b>방송
																	완료 목록이 없습니다.</b></td>
														</tr>
														<!-- list not empty -->
														<tr th:unless="${#lists.isEmpty(dto.liveList)}"
															th:each="item : ${dto.liveList}">
															<td>
																<div class="form-check abc-checkbox">
																	<input class="form-check-input" type="checkbox"
																		th:id="'checkbox'+${itemStat.index}" name="checkBox"
																		th:value="${item.lbSeq}"
																		aria-label="Single checkbox 01"> <label
																		class="form-check-label"
																		th:for="'checkbox'+${itemStat.index}"></label>
																</div>
															</td>
															<td
																th:text="${dto.totalCount - (dto.blockCount * (dto.currentPage - 1)+ itemStat.index)}"></td>
															<td
																th:text="${item.lcName == null} ? 'VOD' : ${item.lcName}"></td>
															<td class="text-left"><a
																href="#"
																th:onclick="goDetail([[ ${item.lbSeq} ]], [[ ${item.lbStatus} ]])"
																th:utext="${item.lbTitle}"></a></td>
															<th:block th:switch="${item.lbStatus}">
																<td th:case="2"><span class="badge badge-info">종료</span></td>
																<td th:case="9"><span class="badge badge-warning">오류</span></td>
																<td th:case="5"><span class="badge badge-secondary">VOD
																		저장중</span></td>
															</th:block>
															<td
																th:text="${#strings.equals(item.lbOpenYn, 'Y')} ? '공개' : '비공개'"></td>
															<td th:text="${item.lbStartDate}"></td>
															<td th:text="${item.lbEndDate}"></td>
															<td th:text="${item.passDuration}"></td>
															<td th:text="${item.regUserName}"></td>
															<td th:text="${item.lbRegDate}"></td>
														</tr>

													</tbody>
												</table>
											</div>
											<!--// 테이블 영역 -->
											<!-- 페이징 -->
											<div th:utext="${dto.pagingHtml}">
												<!-- //페이징 -->
											</div>
											<!--// 방송 완료 탭 내용 -->
										</div>
										<!--// 탭영역 -->
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!--// 컨텐츠 본문 영역 -->
			</div>
		</div>
		<!--// 컨텐츠 영역 -->
</form>
<div th:replace="inc/_footer"></div>