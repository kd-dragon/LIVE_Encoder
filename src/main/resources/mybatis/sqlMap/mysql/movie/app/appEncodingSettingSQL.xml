<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="app_encodingSetting">
	
	<!-- 워터마크 조회 -->
	<select id="watermarkView" resultType="WatermarkVO">
		SELECT
			  WM_SEQ
			, POSITION
			, REG_DATE
			, LU_ID
			, IMG_FILE_PATH
			, IMG_FILE_NAME
			, IMG_SERVER_FILE_NAME
			, REPLACE(IMG_FILE_PATH, #{webRootPath}, '/') IMG_WEB_PATH
			, USE_YN
		FROM TGLIVE_WATERMARK
	</select>
	
	<!-- 워터마크 등록 -->
	<insert id="insertWatermark" parameterType="WatermarkVO">
		INSERT
			INTO TGLIVE_WATERMARK (
				  WM_SEQ
				, POSITION
				, REG_DATE
				, LU_ID
				, IMG_FILE_PATH
				, IMG_FILE_NAME
				, IMG_SERVER_FILE_NAME
				, USE_YN
			) VALUES (
				  '1'
				, #{position}
				, NOW()
				, #{luId}
				, #{imgFilePath}
				, #{imgFileName}
				, #{imgServerFileName}
				, #{useYn}
			)
	</insert>
	
	<!-- 워터마크 업데이트 -->
	<update id="updateWatermark" parameterType="WatermarkVO">
		UPDATE TGLIVE_WATERMARK
		SET
			<if test="position != null and position != ''">
			POSITION = #{position}
			</if>
			, REG_DATE = NOW()
			, LU_ID = #{luId}
			<if test="imgFilePath != ''">
			, IMG_FILE_PATH = IFNULL(#{imgFilePath}, IMG_FILE_PATH)
			</if>
			<if test="imgFileName != ''">
			, IMG_FILE_NAME = IFNULL(#{imgFileName}, IMG_FILE_NAME)
			</if>
			<if test="imgServerFileName != ''">
			, IMG_SERVER_FILE_NAME = IFNULL(#{imgServerFileName}, IMG_SERVER_FILE_NAME)
			</if>
			<if test="useYn != ''">
			, USE_YN = #{useYn}
			</if>
			WHERE WM_SEQ = '1'
	</update>
	
	<!-- 수정 시에 기존 워터마크 삭제하기 위함-->
	<select id="selectWatermark" resultType="WatermarkVO">
		SELECT * FROM TGLIVE_WATERMARK
		WHERE WM_SEQ = '1'
	</select>
	
	<!-- 워터마크 설정 변경 -->
	<update id="updateStatus" parameterType="WatermarkVO">
		UPDATE TGLIVE_WATERMARK
		SET
			POSITION = #{position}
			, LU_ID = #{luId}
			, IMG_FILE_PATH = #{imgFilePath}
			, IMG_FILE_NAME = #{imgFileName}
			, IMG_SERVER_FILE_NAME = #{imgServerFileName}
			, USE_YN = #{useYn}
		WHERE WM_SEQ = '1'
	</update>
	
	<!-- config 조회 -->
	<select id="selectMediaConfig" resultType="SystemConfigVO">
		SELECT  ENCODING_FILE_PATH
			  , RECORDING_FILE_PATH
			  , UPLOAD_ROOT_PATH
			  , WEB_ROOT_PATH
			  , STREAMING_URI
			  , STREAMING_VOD_URI
			  , ENCODER_WORKER_CNT
		  FROM TGLIVE_CONFIG
	</select>
	
	<!-- config update -->
	<update id="updateMediaConfig" parameterType="SystemConfigVO">
		UPDATE TGLIVE_CONFIG
		SET
			<if test="encodingFilePath != null and encodingFilePath != ''">
			ENCODING_FILE_PATH = #{encodingFilePath}
			</if>
			<if test="recordingFilePath != null and recordingFilePath != ''">
			, RECORDING_FILE_PATH = #{recordingFilePath}
			</if>
			<if test="uploadRootPath != null and uploadRootPath != ''">
			, UPLOAD_ROOT_PATH = #{uploadRootPath}
			</if>
			<if test="webRootPath != null and webRootPath != ''">
			, WEB_ROOT_PATH = #{webRootPath}
			</if>
			<if test="streamingUri != null and streamingUri != ''">
			, STREAMING_URI = #{streamingUri}
			</if>
			<if test="streamingVodUri != null and streamingVodUri != ''">
			, STREAMING_VOD_URI = #{streamingVodUri}
			</if>
			<if test="encoderWorkerCnt != null and encoderWorkerCnt != ''">
			, ENCODER_WORKER_CNT = #{encoderWorkerCnt}
			</if>
	</update>
</mapper>
